<template>
    <header class="headerq">
        <van-icon name="arrow-left" size="17px" @click="comeBackCompany"  style="margin-left: -10px;"/>
        <van-search 
      v-model="value"
      shape="round"
      background=""
      placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
    />
    <div class="cart-icon">
      <div class="cart-count">0</div>
    </div>
      
    <van-action-bar>
      <van-action-bar-icon icon="chat-o" text="å®¢æœ" color="#ee0a24" />
      <van-action-bar-icon icon="cart-o" text="è´­ç‰©è½¦" />
      <van-action-bar-icon icon="star" text="å·²æ”¶è—" color="#ff5000" />
    
      <van-action-bar-button ref="button1" @click="handleButton1Click" type="warning"    text="åŠ å…¥è´­ç‰©è½¦" />
    <router-link to="/ck">
      <van-action-bar-button type="danger"  text="ç«‹å³è´­ä¹°" style="width: 110px;" />
      
    </router-link>
    <router-view></router-view>
    </van-action-bar>
        </header>
        <nav class="tabs">
            <cartnav></cartnav>
        </nav>
    <div class="image-container">
 
  
        <van-swipe>
          
      <van-swipe-item>
<div class="product">
       
        <img   src="../views/images/b4.jpg" alt="VOCALOID åˆéŸ³æœªæ¥æ‰‹åŠ">
        <button v-show="false" class="add-to-cart" ref="button2" @click="handleButton2Click" >åŠ å…¥è´­ç‰©è½¦</button>
      </div>  
   
   
  
    </van-swipe-item>
      <van-swipe-item><img src="../views/images/b4.jpg" alt="VOCALOID åˆéŸ³æœªæ¥æ‰‹åŠ"></van-swipe-item>
      <van-swipe-item><img src="../views/images/b4.jpg" alt="VOCALOID åˆéŸ³æœªæ¥æ‰‹åŠ"></van-swipe-item>
      <van-swipe-item><img src="../views/images/b4.jpg" alt="VOCALOID åˆéŸ³æœªæ¥æ‰‹åŠ"></van-swipe-item>
      <template #indicator="{ active, total }">
        <div class="custom-indicator">{{ active + 1 }}/{{ total }}</div>
      </template>
    </van-swipe>
 
        </div>
        <div class="price-section">
            <div>
                <span class="new-price">Â¥234</span>
                <span class="old-price">åŸä»·Â¥199</span>
            </div>
            <div class="discount-tags">
                <span class="discount-tag">æ»¡90å‡15å…ƒ</span>
                <span class="discount-tag">æ»¡109å‡14å…ƒ</span>
                <span class="discount-tag">æ»¡10å‡5å…ƒ</span>
            </div>
        </div>
        <!--  -->
       
        <!--  -->
        <div class="promo-banner">
            <div>
                <span class="price">Â¥210</span>
                <span>é‚®</span>
                <p>æ–°äººä¸“äº«ç¤¼åŒ…ï¼Œå³äº«é¦–å•åŒ…é‚®</p>
            </div>
          <!-- ä¼˜æƒ åˆ¸å•å…ƒæ ¼ -->
    <van-coupon-cell
      :coupons="coupons"
      :chosen-coupon="chosenCoupon"
      @click="showList = true" style=" border-radius: 10px 10px ;"/>
    <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
    <van-popup
      v-model:show="showList"
      round
      position="bottom"
      style="height: 50%; padding-top: 4px;"
    
    >
      <van-coupon-list
        :coupons="coupons"
        :chosen-coupon="chosenCoupon"
        :disabled-coupons="disabledCoupons"
        @change="onChange"
        @exchange="onExchange"
      />
    </van-popup>
    
    
        </div>
    
        <div class="product-info">
            <span class="badge">æœ›å…‰å®¢ç›’</span>
            <span class="badge">ä¸­å›½å¤§é™†ç‹¬å®¶</span>
            
            <h3>ElixirDream é¥¿æ®æ˜</h3>
            <div class="likes">3.3ä¸‡äººæƒ³è¦</div>
        </div>
    
        <div class="product-info">
            <div class="ranking">
                <span>ğŸ† æ’è¡Œæ¦œ</span>
                <span>ä¸–å˜‰æ¦œ No.2</span>
            </div>
        </div>
    
        <div class="product-info">
            <h3>æ´»åŠ¨</h3>
            <div class="activity-item">
                <span class="badge pink">æ¬§æ°”å®ç®±</span>
                æ”¯ä»˜éšæœºç«‹å‡ï¼Œæ¯è·é™å…3æ¬¡
            </div>
            <div class="activity-item">
                <span class="badge pink">æ»¡é¢æƒç›Š</span>
                å†æ¶ˆè´¹199å…ƒå¯è·å¾—ã€Œæ»¡199å…ƒéšæœºç¦åˆ©ã€
            </div>
        </div>
    
        <div class="product-info">
            <h3>å‚æ•°</h3>
            <span>é¢æ–™</span>
            <span>å¡«å……ç‰©</span>
            <span>å°ºå¯¸</span>
        </div>
    
        <div class="product-info">
            <div class="brand">
                <img src="./a3.jpg" alt="VOCALOID" width="40" height="40">
                <span>VOCALOID</span>
            </div>
            <div class="brand">
                <img src="./a3.jpg" alt="SEGA" width="40" height="40">
                <span>ä¸–å˜‰</span>
                <div class="rating">â­â­â­â­â­</div>
            </div>
        </div>
    
        <div class="comments">
            <h3>æ™’å›¾/è®¨è®º </h3>
            <!-- è¯„è®ºå›¾ç‰‡åˆ—è¡¨ -->
        </div>
    
        
    
    </template>
    <style>
      .custom-indicator {
        position: absolute;
      
        right: 20px;
     
        padding: 2px 5px;
        font-size: 14px;
        bottom: 10px;
        right: 10px;
        color: #fff;
        background: rgba(0,0,0,0.5);
        padding: 2px 8px;
        border-radius: 10px;
      }
    </style>
    <script>
 export default {
  data() {
    return {};
  },
  methods: {
    handleButton1Click() {
      if (this.$refs.button2) {
        this.$refs.button2.click();//æ‰‹åŠ¨è§¦å‘æŒ‰é’®2çš„ç‚¹å‡»äº‹ä»¶
      }
    },
    handleButton2Click() {
      // console.log('æŒ‰é’®2è¢«ç‚¹å‡»');
    }
  },
  mounted() {
    // å¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥$refsæ˜¯å¦æ­£ç¡®è·å–äº†å…ƒç´ 
  }
};
document.addEventListener('DOMContentLoaded', () => {
	    const cartIcon = document.querySelector('.cart-icon');
	    const cartCount = document.querySelector('.cart-count');
	    const addToCartButtons = document.querySelectorAll('.add-to-cart');
	  
	    let itemCount = 0; // è´­ç‰©è½¦å•†å“æ•°é‡
	  
	    addToCartButtons.forEach(button => {
	      button.addEventListener('click', event => {
	        const product = event.target.closest('.product');
	        const productImg = product.querySelector('img');
	        const flyImg = productImg.cloneNode(true); // å…‹éš†å•†å“å›¾ç‰‡
	        flyImg.classList.add('fly-img');
	        document.body.appendChild(flyImg);
	  
	        // è·å–èµ·å§‹ä½ç½®
	        const startRect = productImg.getBoundingClientRect();
	        const endRect = cartIcon.getBoundingClientRect();
	  
	        // è®¾ç½®é£è¡Œå›¾ç‰‡åˆå§‹æ ·å¼
	        flyImg.style.left = `${startRect.left}px`;
	        flyImg.style.top = `${startRect.top}px`;
	        flyImg.style.width = `${startRect.width}px`;
	        flyImg.style.height = `${startRect.height}px`;
	  
	        // å¼ºåˆ¶é‡ç»˜ï¼Œç¡®ä¿åˆå§‹æ ·å¼ç”Ÿæ•ˆ
	        window.getComputedStyle(flyImg).transform;
	  
	        // è®¾ç½®ç›®æ ‡ä½ç½®
	        flyImg.style.left = `${endRect.left + endRect.width / 2}px`;
	        flyImg.style.top = `${endRect.top + endRect.height / 2}px`;
	        flyImg.style.width = '20px';
	        flyImg.style.height = '20px';
	        flyImg.style.opacity = '0.5';
	  
	        // åŠ¨ç”»å®Œæˆåç§»é™¤é£è¡Œå›¾ç‰‡ï¼Œå¹¶æ›´æ–°è´­ç‰©è½¦æ•°é‡
	        flyImg.addEventListener('transitionend', () => {
	          flyImg.remove();
	          itemCount++;
	          cartCount.textContent = itemCount;
	        });
	      });
	    });
	  });
	  
</script>
    <script setup>
    
    import cartnav from './cartnav.vue'
    import { ref } from 'vue';
    import { useRouter } from 'vue-router';
    
    const router = useRouter();
    let comeBackCompany = () => {
     
      
      router.go(-1);
    };
    const coupon = {
      available: 1,
      condition: 'æ— é—¨æ§›\næœ€å¤šä¼˜æƒ 12å…ƒ',
      reason: '',
      value: 150,
      name: 'ä¼˜æƒ åˆ¸åç§°',
      startAt: 1489104000,
      endAt: 1514592000,
      valueDesc: '1.5',
      unitDesc: 'å…ƒ',
    };
    
    const coupons = ref([coupon]);
    const showList = ref(false);
    const chosenCoupon = ref(-1);
    
    const onChange = (index) => {
      showList.value = false;
      chosenCoupon.value = index;
    };
    
    const onExchange = (code) => {
      coupons.value.push(coupon);
    };
    const disabledCoupons = [coupon];
    const api = {
      coupons,
      showList,
      onChange,
      onExchange,
      chosenCoupon,
      disabledCoupons,
    };
    
    
    </script>
    <style scoped>
button .add-to-cart{
  z-index: 1111;
  position: fixed;


}
 .cart-icon {
    z-index: 9999;
      position: fixed;
      top: 616px;
        left: 90px;
      height: 70px;
      background: url('cart-icon.png') no-repeat center / cover;
      
      border-radius: 50%;
     
    }
    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .product button {
      padding: 8px 16px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .product button:hover {
      background: #0056b3;
    }

    .fly-img {
      position: absolute;
      z-index: 1000;
      transition: all 1s ease;
      pointer-events: none;
    }
    
    </style>
    <style>
    
    
    .headerq {
        display: flex;
        align-items: center;
        padding: 1px 30px;
        background: #fff;
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .search-bar {
        flex: 1;
        margin: 0 15px;
        padding: 8px 15px;
        background: #f5f5f5;
        border-radius: 20px;
        display: flex;
        align-items: center;
    }
    
    .tabs {
       
        display: flex;
        justify-content: space-around;
        padding: 1px 0;
        background: #fff;
        border-bottom: 1px solid #eee;
         
    }
    
    
    .tab.active::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 0;
        width: 100%;
        height: 2px;
        background: #ff2c54;
    }
    
    .promo-banner {
        margin: 10px;
        background: linear-gradient(to right, #ff6b9d, #ff2c54);
        border-radius: 10px;
        padding: 15px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .price {
        font-size: 24px;
        font-weight: bold;
    }
    
    .product-info {
        background: #fff;
        padding: 15px;
        margin: 10px 0;
    }
    
    .badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        background: #ff69b4;
        font-size: 12px;
        margin-right: 5px;
    }
    
    .bottom-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
        padding: 10px 15px;
        background: #fff;
        border-top: 1px solid #eee;
    }
    
    .btn {
        flex: 1;
        padding: 10px;
        border-radius: 20px;
        border: none;
        margin: 0 5px;
        font-size: 14px;
    }
    
    .btn-cart {
        background: #fff;
        border: 1px solid #ff2c54;
        color: #ff2c54;
    }
    
    .btn-buy {
        background: #ff2c54;
        color: #fff;
    }
    
    
    .image-container {
        position: relative;
        width: 100%;
        background: #fff;
    }
    
    .image-container img {
        
        width: 100%;
        height: auto;
    }
    
    
    .price-section {
        
        padding: 10px;
        background: #fff;
    }
    
    .new-price {
        color: #ff4d94;
        font-size: 24px;
        font-weight: bold;
    }
    
    .old-price {
        color: #999;
        text-decoration: line-through;
        margin-left: 10px;
    }
    
    .discount-tags {
        display: flex;
        gap: 10px;
        margin: 10px 0;
    }
    
    .discount-tag {
        color: #ff4d94;
        border: 1px solid #ff4d94;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
    }
    </style>